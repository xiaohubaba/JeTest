<!--index.wxml-->
<wxs src="../../utils/subutils.wxs" module="tools"></wxs>
<view class="container">
    <block>
      <!-- <image bindtap="bindViewTap" class="userinfo-avatar" src="{{userInfo.avatarUrl}}" mode="cover"></image> -->
      <block wx:if="{{hasUserInfo && canIUse && !sureInfo && !phone}}">
        <view class="login-way">
          <image src="../../images/logo.jpg" class="head-img" />
          <button class="btn" bindgetuserinfo="weixinLogin" open-type="getUserInfo" wx:if="{{!authorize}}">
            <image class="weixin" src="../../images/weixin.png" />
            <text>微信登录</text>
            </button>
              <button class="btn" bindgetphonenumber="weixinPhoneLogin" open-type="getPhoneNumber" wx:else>
            <image class="weixin" src="../../images/weixin.png" />
            <text>微信登录</text>
            </button>
        <view bind:tap="phoneLogin">手机号登录</view>
        </view>
          <view class="notice">
          未注册WeTest的手机号，登录时将自动注册，且代表您
     已同意<text>《WeTest注册协议》</text>和<text>《WeTest隐私政策》</text>
        </view>
      </block>
     <block wx:else>
       <view class="page">
       <view class="header-swiper">
        <swiper indicator-dots="{{indicatorDots}}" style="height:200px"
        autoplay="{{autoplay}}" interval="{{interval}}" duration="{{duration}}">
        <block wx:for="{{swiperList}}" wx:key="*this">
          <swiper-item>
            <image class="swiper-item" data-id='{{index}}' src="{{item}}" />
          </swiper-item>
        </block>
      </swiper>
       </view>
       <view class="list">
       <image src="../../images/shiguan.png" bind:tap="allProject" />
       <image src="../../images/shiguan.png" bind:tap="myProject" />
       </view>
        <view class="list1">
       <text bind:tap="allProject">项目列表</text>
        <text bind:tap="myProject">我的项目</text>
       </view>
       <view class="bluetooth-equip">
         <view class="left">
           <image src="../../images/equipment.png" />
           <text>我的设备</text>
         </view>
         <view type="default" size="mini" class="bluetooth-btn" bind:tap="addEquipmet">+添加</view>
       </view>
     <block wx:if="{{list.length}}">
      <scroll-view scroll-x="{{true}}" style="white-space: nowrap;display: flex">
        <block wx:for="{{list.length > 5 ? list.slice(0,5) : list}}" wx:key="item" wx:for-index="index">
            <view  class="isconnect" bind:tap="createBLEConnection" data-id="{{item.deviceId}}">
         <image src="../../images/equipment.png" class="image" />
         <view class="bluetooth">
           <image src="{{item.isconnect ? '../../images/bluetooth.png' : '../../images/isnot.png'}}" class="image1" />
           <text>{{item.isconnect ? '已连接' : '未连接'}}</text>
         </view>
         <text class="last-text">MAC {{tools.subStr(item.deviceId,0,14)}}</text>
       </view>
       </block>
      </scroll-view>
     </block>
       </view>
     </block>
    </block>
    <!-- 弹出微信登录弹窗 -->
     <block  wx:if="{{!authorize}}">
  <view class="{{showModal ? 'userinfo' : 'userinfo hide'}}">
    <!-- <button wx:if="{{!hasUserInfo && canIUse}}" open-type="getUserInfo" bindgetuserinfo="getUserInfo">
    获取你的昵称、头像、地区及性别
    </button> -->
    <text class="title">WeTest   申请</text>
      <view  open-type="getUserInfo" bindgetuserinfo="getUserInfo" class="view">
     <text class="info">获取你的昵称、头像、地区及性别</text>
     <view class="divide-line"></view>
     <view class="personal-info">
     <view class="left">
       <image src="{{userInfo.avatarUrl}}" class="image" />
       <view class="right">
         <text>{{userInfo.nickName}}</text>
          <text>微信个人信息</text>
       </view>
     </view>
     <image src="../../images/correct.png" />
     </view>
     <text class="use-other" bind:tap="userOther">使用其他头像和昵称</text>
     <view class="bottom-btn">
       <button size="mini" bind:tap="cancelLogin">取消</button>
       <button size="mini" type="primary" bindgetuserinfo="getUserInfo">允许</button>
     </view>
    </view>
    </view>
     </block>
     <block wx:else>
      <view class="{{showModal1 ? 'userinfo' : 'userinfo hide1'}}">
    <!-- <button wx:if="{{!hasUserInfo && canIUse}}" open-type="getUserInfo" bindgetuserinfo="getUserInfo">
    获取你的昵称、头像、地区及性别
    </button> -->
    <text class="title">WeTest   申请使用</text>
      <view  open-type="getUserInfo" bindgetuserinfo="getUserInfo" class="view">
     <text class="info">你的手机号码</text>
     <view class="divide-line"></view>
     <view class="personal-info">
     <view class="left">
      <text>{{phoneNumber}}    微信绑定号码</text>
     </view>
     <image src="../../images/correct.png" />
     </view>
     <text class="use-other" bind:tap="userOtherPhone">使用其他手机号码</text>
     <view class="bottom-btn">
       <button size="mini" bind:tap="cancelLogin">取消</button>
       <button size="mini" type="primary" open-type="getUserInfo" bindgetuserinfo="getUserInfo">允许</button>
     </view>
    </view>
    </view>
     </block>
</view>
